name: Tasting üç¥

on: push

jobs:
  tasting-on-windows:
    runs-on: windows-latest

    name: Tasting on Windows üç¥

    steps:
    - uses: actions/checkout@v3

    - uses: actions/checkout@v3
      with:
        repository: Floorp-Projects/Floorp-AutoPatcher
        path: tools

    - uses: actions/setup-go@v3
      with:
        go-version: '1.19.4'

    - name: Tasting
      run: |
        .\build.bat
        cd tools
        go build
        copy autopatcher.exe ..
        cd ..
        ./autopatcher.exe
        dir
        cd core
        $fver=./floorp.exe  '-version' | more
        echo "Floorp Version: $($fver.Split()[2])"
        cd ..

    - name: Great taste!
      uses: actions/upload-artifact@v3
      with:
        name: windows-test
        path: |
            floorp.exe
            patcher.exe
            autopatcher.exe

  tasting-on-linux:
    runs-on: ubuntu-22.04

    name: Tasting on Linux üêß

    steps:
    - uses: actions/checkout@v3

    - uses: actions/setup-go@v3
      with:
        go-version: '1.19.4'

    - name: Tasting
      run: |
        mkdir core
        chmod +x ./build.sh
        ./build.sh
        cd floorp_downloader
        npm install
        npm run start linux x86_64
        tar -xvf floorp-package.tar.bz2
        mv floorp/* ../core/
        cd ..
        ./patcher
        ls -l
        cd core
        fver=`./floorp -version | awk '{ print $3 }'`
        echo "Floorp Version: $fver"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Great taste!
      uses: actions/upload-artifact@v3
      with:
        name: linux-test
        path: |
            floorp
            patcher
